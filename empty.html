<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <meta charset="utf-8" />
    <title>Simple Snake like Game</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body style="display: flex; justify-content: center; align-items: center; height: 100%;">

    <canvas id="myCanvas" width="480" height="320"></canvas>

    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var size = 20;

        var maxX = 480 / size - 1;
        var maxY = 320 / size - 1;
        var minX = 0;
        var minY = 0;

        var fruchtX = 0;
        var fruchtY = 0;


        var schlangeArrayX = [Math.round(maxX / 2)];
        var schlangeArrayY = [Math.round(maxY / 2)];

        var highscore = 0;

        var up2Pressed = false;
        var down2Pressed = false;
        var left2Pressed = false;
        var righ2Pressed = false;

        var rightPressed = false;
        var leftPressed = false;
        var upPressed = false;
        var downPressed = false;
        var spacePressed = false;

        var gameOver = false;

        var richtung = -1; //0 = rechts, 1 = links, 2 = oben, 3 = unten

        var timer = 0;
        var speed = 10;

        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        //Taste gedrückt
        function keyDownHandler(e) {
            if (e.code == "ArrowRight") {
                rightPressed = true;
            }
            else if (e.code == 'ArrowLeft') {
                leftPressed = true;
            }
            else if (e.code == 'ArrowUp') {
                upPressed = true;
            }
            else if (e.code == 'ArrowDown') {
                downPressed = true;
            }
            else if (e.code == "KeyD") {
                right2Pressed = true;
            }
            else if (e.code == 'KeyA') {
                left2Pressed = true;
            }
            else if (e.code == 'KeyW') {
                up2Pressed = true;
            }
            else if (e.code == 'KeyS') {
                down2Pressed = true;
            }
            else if (e.code == 'Space') {
                spacePressed = true;
            }
        }
        //Taste losgelassen
        function keyUpHandler(e) {
            if (e.code == 'ArrowRight') {
                rightPressed = false;
            }
            else if (e.code == 'ArrowLeft') {
                leftPressed = false;
            }
            else if (e.code == 'ArrowUp') {
                upPressed = false;
            }
            else if (e.code == 'ArrowDown') {
                downPressed = false;
            }
            else if (e.code == 'KeyD') {
                righ2tPressed = false;
            }
            else if (e.code == 'KeyA') {
                left2Pressed = false;
            }
            else if (e.code == 'KeyW') {
                up2Pressed = false;
            }
            else if (e.code == 'KeyS') {
                down2Pressed = false;
            }
            else if (e.code == 'Space') {
                spacePressed = false;
            }
        }

        //Zeichnen der Schlange
        function moveSnake() {
            for (var i = 0; i < schlangeArrayX.length - 1; i++) {
                schlangeArrayX[i] = schlangeArrayX[i + 1];
                schlangeArrayY[i] = schlangeArrayY[i + 1];
            }
        }


        //Zeichnen der Schlange
        function drawSnake() {
            for (var i = 0; i < schlangeArrayX.length; i++) {
                var posX = schlangeArrayX[i];
                var posY = schlangeArrayY[i];

                ctx.beginPath();
                ctx.rect(posX * size, posY * size, size, size);
                ctx.fillStyle = "#109DDD";
                ctx.fill();
                ctx.closePath();
            }
        }

        function neueFruchtPostionBerechnen() {
            fruchtX = Math.round((Math.random() * (maxX - 0)) + 0);
            fruchtY = Math.round((Math.random() * (maxY - 0)) + 0);
            for (var i = 0; i < schlangeArrayX.length - 1; i++) {
                if (schlangeArrayX[i] == fruchtX && schlangeArrayY[i] == fruchtY) {
                    neueFruchtPostionBerechnen ();
                }
            }

        }

        //Zeichnen der Frucht
        function drawFruit() {
            ctx.beginPath();
            ctx.arc(fruchtX * size + size / 2, fruchtY * size + size / 2, size / 2, 0, Math.PI * 2);
            ctx.fillStyle = "#ff5533";
            ctx.fill();
            ctx.closePath();
        }

        function drawHighscore() {
            ctx.font = "20px Verdana";
            ctx.fillText(highscore, 235, 40);
        }

        function checkSnakeCollidesWithItself() {
            var posX = schlangeArrayX[schlangeArrayX.length - 1];
            var posY = schlangeArrayY[schlangeArrayY.length - 1];

            for (var i = 0; i < schlangeArrayX.length - 1; i++) {
                if (schlangeArrayX[i] == posX && schlangeArrayY[i] == posY) {
                    gameOver = true;
                }
            }
        }

        function drawgameover() {
            if (gameOver == true) {
                ctx.font = "40px Verdana";
                ctx.fillText("Game over", 150, 300);
                schlangeArrayX = [Math.round(maxX / 2)];
                schlangeArrayY = [Math.round(maxY / 2)];
                richtung = -1
            }
        }




        //Alles zeichen
        function draw() {
            //Löschen der Zeichnfläche
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawSnake();
            drawFruit();
            checkSnakeCollidesWithItself();
            drawHighscore();
            drawgameover();

            timer = timer + 1;
            if (timer > speed) {
                timer = 0;
            }

            var schlangeX = schlangeArrayX[schlangeArrayX.length - 1];
            var schlangeY = schlangeArrayY[schlangeArrayY.length - 1];

            if (richtung == 0 && timer == 0) {
                moveSnake();
                schlangeX = schlangeX + 1;

            }
            else if (richtung == 1 && timer == 0) {
                moveSnake();
                schlangeX = schlangeX - 1;
            }
            else if (richtung == 2 && timer == 0) {
                moveSnake();
                schlangeY = schlangeY - 1;
            }
            else if (richtung == 3 && timer == 0) {
                moveSnake();
                schlangeY = schlangeY + 1;
            }

            // Grenzüberwachung
            if (schlangeX > maxX) {
                schlangeX = maxX;
                gameOver = true;
            }
            if (schlangeX < minX) {
                schlangeX = minX;
                gameOver = true;
            }
            if (schlangeY > maxY) {
                schlangeY = maxY;
                gameOver = true;
            }
            if (schlangeY < minY) {
                schlangeY = minY;
                gameOver = true;
            }


            if (rightPressed && richtung != 1 && gameOver != true) {
                richtung = 0;
            }
            else if (leftPressed && richtung != 0 && gameOver != true) {
                richtung = 1;
            }
            else if (upPressed && richtung != 3 && gameOver != true) {
                richtung = 2;
            }
            else if (downPressed && richtung != 2 && gameOver != true) {
                richtung = 3;
            }

            if (schlangeX == fruchtX && schlangeY == fruchtY) {
                highscore = highscore + 1
                neueFruchtPostionBerechnen();

                schlangeArrayX.push(schlangeX);
                schlangeArrayY.push(schlangeY);
            }

            if (spacePressed) {
                highscore = 0;
                gameOver = false;
                schlangeX = Math.round(maxX / 2);
                schlangeY = Math.round(maxY / 2);
                richtung = -1;
            }

            schlangeArrayX[schlangeArrayX.length - 1] = schlangeX
            schlangeArrayY[schlangeArrayY.length - 1] = schlangeY

            //Immer wieder alles Zeichnen -> 60fps, d.h. draw wird alle 16ms aufgerufen.
            requestAnimationFrame(draw);
        }

        neueFruchtPostionBerechnen();
        //Zeichnen erstmalig aufrufen
        draw();




    </script>

</body>

</html>