<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <meta charset="utf-8" />
    <title>Simple Snake like Game</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body style="display: flex; justify-content: center; align-items: center; height: 100%;">

    <canvas id="myCanvas" width="480" height="320"></canvas>

    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var size = 12;

        var positionSnakeX = [11];
        var positionSnakeY = [8];

        var positionFruitX = 5;
        var positionFruitY = 3;

        var direction = 0; // 1 = nach rechts, 2 = nach links, 3= nach oben, 4 = nach unten
        var lastDrawnDirection = 0; // 1 = nach rechts, 2 = nach links, 3= nach oben, 4 = nach unten

        var delay = 10;
        var cycle = 0;

        var rightPressed = false;
        var leftPressed = false;
        var upPressed = false;
        var downPressed = false;
        var spacePressed = false;

        var gameOver = false;

        var highscore = 0;

        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        //Taste gedrÃ¼ckt
        function keyDownHandler(e) {
            if (e.code == "ArrowRight") {
                rightPressed = true;
            }
            else if (e.code == 'ArrowLeft') {
                leftPressed = true;
            }
            else if (e.code == 'ArrowUp') {
                upPressed = true;
            }
            else if (e.code == 'ArrowDown') {
                downPressed = true;
            }
            else if (e.code == 'Space') {
                spacePressed = true;
            }
        }
        //Taste losgelassen
        function keyUpHandler(e) {
            if (e.code == 'ArrowRight') {
                rightPressed = false;
            }
            else if (e.code == 'ArrowLeft') {
                leftPressed = false;
            }
            else if (e.code == 'ArrowUp') {
                upPressed = false;
            }
            else if (e.code == 'ArrowDown') {
                downPressed = false;
            }
            else if (e.code == 'Space') {
                spacePressed = false;
            }
        }

         //code from https://tech.saigonist.com/b/code/how-detect-swipe-touch-event-mobile-browsers-javascript.html
         function handySwipe() {
            document.addEventListener('touchstart', handleTouchStart, false);
            document.addEventListener('touchmove', handleTouchMove, false);

            var xDown = null;
            var yDown = null;

            function handleTouchStart(evt) {
                xDown = evt.touches[0].clientX;
                yDown = evt.touches[0].clientY;
            };

            function handleTouchMove(evt) {
                if (!xDown || !yDown) {
                    return;
                }

                var xUp = evt.touches[0].clientX;
                var yUp = evt.touches[0].clientY;

                var xDiff = xDown - xUp;
                var yDiff = yDown - yUp;

                if (Math.abs(xDiff) > Math.abs(yDiff)) {/*most significant*/
                    if (xDiff > 0) {
                        leftPressed = true;
                    } else {
                        rightPressed = true;
                    }
                } else {
                    if (yDiff > 0) {
                        upPressed = true;
                    } else {
                        downPressed = true;
                    }
                }
                /* reset values */
                xDown = null;
                yDown = null;
            };
        }

        //Zeichnen der Schlange
        function drawSnake() {
            for (var i = 0; i < positionSnakeX.length; i = i + 1) {
                var x = positionSnakeX[i]
                var y = positionSnakeY[i]
                ctx.beginPath();
                ctx.arc(x * size * 2 + size, y * size * 2 + size, size, 0, Math.PI * 2);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                ctx.closePath();
            }
        }

        function newfruitPosition() {
            positionSnakeX.push(positionFruitX)
            positionSnakeY.push(positionFruitY)
            positionFruitX = Math.round(Math.random() * (19 - 0)) + 0;
            positionFruitY = Math.round(Math.random() * (12 - 0)) + 0;
            highscore = highscore + 1

        }
        function drawHighscore() {
            ctx.font = "18px serif";
            ctx.fillStyle = "#DAA520";
            ctx.fillText("Highscore: " + highscore, 3, 14);
        }

        function drawfruit() {
            ctx.beginPath();
            ctx.arc(positionFruitX * size * 2 + size, positionFruitY * size * 2 + size, 7, 0, Math.PI * 2);
            ctx.fillStyle = "#FF4500";
            ctx.fill();
            ctx.closePath();
        }
        function drawGameOver() {
            if (gameOver) {
                ctx.font = "100px serif";
                ctx.fillStyle = "#FF4500";
                ctx.fillText(" GameOver ", 1, 180);
            }
        }
        function spacepressReset() {
            newfruitPosition()
            direction = 0;
            lastDrawnDirection = 0;
            highscore = 0;
            gameOver = false;
            positionSnakeX = [11];
            positionSnakeY = [8];
        }
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawSnake();
            drawfruit();
            drawHighscore();
            drawGameOver();
            if (spacePressed) {
                spacepressReset()
                spacePressed = false;
            }

            var snakeHeadX = positionSnakeX[positionSnakeX.length - 1]
            var snakeHeadY = positionSnakeY[positionSnakeX.length - 1]

            if (leftPressed && (lastDrawnDirection == 3 || lastDrawnDirection == 4 || lastDrawnDirection == 0)) {
                direction = 2
                leftPressed = false;
            }
            else if (rightPressed && (lastDrawnDirection == 3 || lastDrawnDirection == 4 || lastDrawnDirection == 0)) {
                direction = 1
                rightPressed = false;
            }
            else if (upPressed && (lastDrawnDirection == 1 || lastDrawnDirection == 2 || lastDrawnDirection == 0)) {
                direction = 4
                upPressed = false;
            }
            else if (downPressed && (lastDrawnDirection == 1 || lastDrawnDirection == 2 || lastDrawnDirection == 0)) {
                direction = 3
                downPressed = false;
            }

            if (gameOver == false) {

                if (snakeHeadX < 0 || snakeHeadX > 19 || snakeHeadY < 0 || snakeHeadY > 12) {
                    gameOver = true
                }

                cycle = cycle + 1;
                if (cycle == delay) {
                    cycle = 0;

                    lastDrawnDirection = direction;

                    if (direction == 1) { // nach rechts
                        snakeHeadX = snakeHeadX + 1;
                    }
                    else if (direction == 2) { // nach links
                        snakeHeadX = snakeHeadX - 1;
                    }
                    else if (direction == 3) { // nach oben
                        snakeHeadY = snakeHeadY + 1;
                    }
                    else if (direction == 4) { // nach unten 
                        snakeHeadY = snakeHeadY - 1;
                    }

                    if (direction != 0) {

                        for (var i = 1; i < positionSnakeX.length; i = i + 1) {
                            var currX = positionSnakeX[i]
                            var currY = positionSnakeY[i]

                            if (currX == snakeHeadX && currY == snakeHeadY)
                                gameOver = true

                        }


                        for (var i = 1; i < positionSnakeX.length; i = i + 1) {
                            positionSnakeX[i - 1] = positionSnakeX[i]
                            positionSnakeY[i - 1] = positionSnakeY[i]
                        }
                        positionSnakeX[positionSnakeX.length - 1] = snakeHeadX;
                        positionSnakeY[positionSnakeY.length - 1] = snakeHeadY;
                    }
                }

                if (snakeHeadX == positionFruitX && snakeHeadY == positionFruitY) {
                    newfruitPosition();
                }
            }
            //Immer wieder alles Zeichnen -> 60fps, d.h. draw wird alle 16ms aufgerufen.
            requestAnimationFrame(draw);
        }

        handySwipe();
        //Zeichnen erstmalig aufrufen
        draw();
    </script>

</body>

</html>